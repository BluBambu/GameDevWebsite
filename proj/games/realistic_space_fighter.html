<!DOCTYPE html>
<html>
<head>
    <title>HTML5 Canvas</title>
    <script>
function get_canvas_cursor_position(canvas, evt) {
	var rect = canvas.getBoundingClientRect();
	return {
		x: evt.clientX - rect.left,
		y: evt.clientY - rect.top
	};
}
  
var _canvas;
var _g;
var WID = 850;
var HEI = 500;
var _gameobjs = [];
var _ships = [];
var _mouse_pos;

var COLOR = {
	RED: "rgb(255,0,0)",
	GREEN: "rgb(0,255,0)",
	BLUE: "rgb(0,0,255)",
	BLACK: "rgb(0,0,0)",
	WHITE: "rgb(255,255,255)"
};
    
window.onload = function() {
	_canvas = document.getElementById("game");
	_g = document.getElementById("game").getContext("2d");
		
	window.addEventListener('keydown', key_down);
	window.addEventListener('keyup',key_up);
	_canvas.addEventListener('mousedown',mouse_down);
	_canvas.addEventListener('mouseup',mouse_up);
	_canvas.addEventListener('mousemove',mouse_move);
	
	setInterval(update, 40);
	
	_ships.push(make_ship(200, HEI / 2, -1));
	_ships.push(make_ship(WID - 200, HEI / 2, 1));
}

function mouse_down(e){
	_mouse_pos = get_canvas_cursor_position(_canvas,e);
	_gameobjs.push(make_object(_mouse_pos.x,_mouse_pos.y));
}
function mouse_up(e) {var mouse_pos = get_canvas_cursor_position(_canvas,e);}
function mouse_move(e) { var mouse_pos = get_canvas_cursor_position(_canvas,e);}
function key_down(e) { console.log(e.keyCode) }
function key_up(e) {}

function make_object(x,y) {
	//console.log(x + " " + y);
	var rtv = {};
	rtv.x = _ships[0].x;// * _ships[0].vx;
	rtv.y = _ships[0].y;// * _ships[0].vy;
	
	var delta = {x: x - rtv.x, y: y - rtv.y};
	var delta_len = Math.sqrt(Math.pow(delta.x, 2) + Math.pow(delta.y, 2));
	var normalized_delta = {x: delta.x / delta_len, y:delta.y / delta_len};
	
	rtv.vx = normalized_delta.x * 10;// + _ships[0].vx;//Math.random()*10-5;
	rtv.vy = normalized_delta.y * 10;// + _ships[0].vy; //Math.random()*10-5
	return rtv;
}

function make_ship(x,y, n) {
	var rtv = {};
	rtv.x = x;
	rtv.y = y;
	rtv.vx = 0;//Math.random()*10-5;
	rtv.vy = n * 5; //Math.random()*10-5
	return rtv;
}

function get_gravity_center() {
	return {x:WID/2,y:HEI/2};
}

function distance_to_gravity_center(x,y) {
	var grav_center = get_gravity_center();
	return Math.sqrt(Math.pow(grav_center.x-x,2)+Math.pow(grav_center.y-y,2));
}

function update() {
	_g.clearRect(0,0,WID,HEI);
	
	_g.fillStyle = COLOR.BLACK;
	_g.fillRect(0,0,WID,HEI);
	
	_g.fillStyle = COLOR.GREEN;
	_g.beginPath();
	_g.arc(WID*0.5,HEI*0.5,20,0,Math.PI*2);
	_g.closePath();
	_g.fill();
	
	for (var i_ship = 0; i_ship < _ships.length; i_ship++) {
		var itr_ship = _ships[i_ship];
		
		itr_ship.x += itr_ship.vx;
		itr_ship.y += itr_ship.vy;
		
		var intensity = 1/distance_to_gravity_center(itr_ship.x,itr_ship.y) * 200;
		var delta = {x:get_gravity_center().x-itr_ship.x, y:get_gravity_center().y-itr_ship.y};
		var delta_len = Math.sqrt(Math.pow(delta.x,2)+Math.pow(delta.y,2));
		var normalized_delta = {x:delta.x/delta_len,y:delta.y/delta_len};
		itr_ship.vx += normalized_delta.x*intensity;
		itr_ship.vy += normalized_delta.y*intensity;
		
		if (i_ship == 0) {
			_g.fillStyle = COLOR.BLUE;
		} else {
			_g.fillStyle = COLOR.WHITE;
		}
		
		_g.beginPath();
		_g.arc(itr_ship.x,itr_ship.y, 10 ,0,Math.PI*2);
		_g.closePath();
		_g.fill();
		
		for (var i = 0; i < _gameobjs.length; i++) {
			cur = _gameobjs[i];
			if (Math.sqrt(Math.pow(cur.x - itr_ship.x, 2) + Math.pow(cur.y - itr_ship.y, 2)) < 10) {
				console.log("Ship " + i_ship + " is hit!");
				_gameobjs.splice(i, i+1);
			}
		}
	}
	
	for(var i_obj = 0; i_obj < _gameobjs.length; i_obj++) {
		var itr_obj = _gameobjs[i_obj];
		
		itr_obj.x += itr_obj.vx;
		itr_obj.y += itr_obj.vy;
		
		var intensity = 1/distance_to_gravity_center(itr_obj.x,itr_obj.y) * 100;
		var delta = {x:get_gravity_center().x-itr_obj.x, y:get_gravity_center().y-itr_obj.y};
		var delta_len = Math.sqrt(Math.pow(delta.x,2)+Math.pow(delta.y,2));
		var normalized_delta = {x:delta.x/delta_len,y:delta.y/delta_len};
		itr_obj.vx += normalized_delta.x*intensity;
		itr_obj.vy += normalized_delta.y*intensity;
		
		_g.fillStyle = COLOR.RED;
		_g.beginPath();
		_g.arc(itr_obj.x,itr_obj.y,5,0,Math.PI*2);
		_g.closePath();
		_g.fill();
	}
}
  
    </script>
</head>
<body>
    <canvas id="game"  width="850px" height="500px" style="margin:auto;display:block;"></canvas>
</body>
</html>